<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>数据统计</title>
    <link rel="stylesheet" href="/static/css/bootstrap.min.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=2.0, user-scalable=yes" />
</head>
<body>
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">后台管理系统</a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav">
            <li><a href="/static/admin/index.html">首页</a></li>
            <li><a href="/static/admin/chatimg.html">聊天管理</a></li>
            <li><a href="/static/admin/traveledit.html">旅游管理</a></li>
            <li><a href="/static/admin/gallery.html">画廊管理</a></li>
            <li><a href="/static/admin/tongji.html">数据统计</a></li>
            <li><a href="/static/admin/system.html">系统统计</a></li>
          </ul>
        </div>
      </div>
    </nav>
    <hr>
    <div id="chatImgCountLine" style="width: 100%;height:300px;"></div>
    <hr>
    <div id="chatTimesLine" style="width: 100%;height:300px;"></div>
    <hr/>
    <div id="contentTongji" style="width: 100%">
        <div class="wordCount">
            <button id="getContentBtn" class="btn btn-primary">获取内容信息</button>
        </div>
        <img style="width: 100%"/>
    </div>
    <hr/>
    <div id="galleryCountTongji" style="width: 100%">
    </div>
    <hr/>
    <div id="OSSFileTongji" style="width: 100%">
    </div>
    <hr/>
    <div id="OSSFileDownload" style="width: 100%">
    </div>
</body>
<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/bootstrap.min.js"></script>
<script src="/static/js/echarts.common.min.js"></script>
<script type="text/javascript">
    $.ajax({
        url:"/admin/tongji/getChatImageCount",
        dataType: 'json',
        type:"POST",
        success:function(data){
            var totalImgCount = 0;
            timeArr = new Array();
            dataArr = new Array();
            $.each(data,function(i,n){
                totalImgCount += n;
                timeArr.push(i);
                dataArr.push(n);
            });
            drawLine("chatImgCountLine","聊天截图数量("+totalImgCount+")",timeArr,dataArr)
        }
    });

    $.ajax({
        url:"/admin/tongji/getChatTimes",
        dataType: 'json',
        type:"POST",
        success:function(data){
            timeArr = new Array();
            dataArr = new Array();
            $.each(data,function(i,n){
                timeArr.push(n.time);
                dataArr.push(n.count);
            });
            drawLine("chatTimesLine","聊天时段统计",timeArr,dataArr)
        }
    });

    $("#getContentBtn").click(function(){
        getContent();
    });

    function getContent(){
        $.ajax({
            url:"/admin/tongji/getContent",
            dataType: 'json',
            type:"POST",
            success:function(data){
               $("#contentTongji .wordCount").html("一共有"+data.wordCount+"字的旅行游记");
               $("#contentTongji img").attr("src",data.wordCloudPath);
            }
        });
    }

    $.ajax({
        url:"/admin/tongji/getGalleryCount",
        dataType: 'json',
        type:"POST",
        success:function(data){
           $("#galleryCountTongji").html("一共有"+data.galleryCount+"个景点，有"+data.galleryImgCount+"张照片");
        }
    });

    $.ajax({
        url:"/admin/tongji/getOSSFile",
        dataType: 'json',
        type:"POST",
        success:function(data){
           var html = "OSS中的文件：";
           $.each(data,function(file,size){
                html+="<div ondblclick=\"downloadOssFile('"+file.replace(' ','_')+"')\" class=\"alert alert-info\" role=\"alert\" style='margin-bottom: 0px'>"+file+" ("+Math.floor(size / 1024 / 1024 * 100) / 100+" MB)</div>"
           });
           $("#OSSFileTongji").html(html);
        }
    });

    function downloadOssFile(fileName){
        $.ajax({
            url:"/admin/tongji/downloadOSSFile",
            data:"fileName="+fileName,
            type:"POST",
            success:function(data){
                $("#OSSFileDownload").html("<a href='"+data.filePath+"' class='btn btn-primary'>下载"+data.fileName+"</a>");
            }
        });
    }

    function drawLine(id,title,timeArr,dataArr){
        var option = {
            title: {
                text: title
            },
            tooltip: {
                trigger: 'axis'
            },
            legend: {
                data:['GPS','BDS','GLONASS','GALILEO']
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            toolbox: { //可视化的工具箱
                show: true,
                feature: {
                    dataView: { //数据视图
                        show: true
                    },
                    restore: { //重置
                        show: true
                    },
                    dataZoom: { //数据缩放视图
                        show: true
                    },
                    saveAsImage: {//保存图片
                        show: true
                    },
                    magicType: {//动态类型切换
                        type: ['bar', 'line']
                    }
                }
            },
            xAxis: {
                type: 'category',
                boundaryGap: false,
                data: timeArr
            },
            yAxis: {
                type: 'value'
            },
            series: [
                {
                    name:'数量',
                    type:'line',
                    data:dataArr
                }

            ]
        };
        echarts.init(document.getElementById(id)).setOption(option);
    }
</script>
</html>