<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>【文斌 & 静静】爱的小窝-我们的旅程</title>
<link rel="shortcut icon" href="/static/images/favicon.ico" type="image/x-icon" />
<link href="/static/css/style.css" rel="stylesheet" type="text/css">
<link href="/static/css/color.css" rel="stylesheet" type="text/css">
<link href="/static/css/bootstrap-responsive.css" rel="stylesheet" type="text/css">
<link href="/static/css/bootstrap.css" rel="stylesheet" type="text/css">
<link href="/static/css/countdown.css" rel="stylesheet" type="text/css">
<link href="/static/css/prettyPhoto.css" rel="stylesheet">
<script type="text/javascript" src="/static/js/jquery-1.8.3.js"></script>
<script type="text/javascript" src="/static/js/mobile.js"></script>
<script type="text/javascript" src="/static/js/bootstrap.js"></script>
<script type="text/javascript" src="/static/js/jquery.countdown.js"></script>
<script type="text/javascript" src="/static/js/jquery.prettyPhoto.js"></script>
<script type="text/javascript" src="/static/js/lightbox.js"></script>
<script type="text/javascript" src="/static/js/custom.js"></script>
<script type="text/javascript" src="/static/js/jquery.cookie.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=0LSHte0xuZrXWUrnkEDIIMfwlOnYfiTA"></script>
<script type="text/javascript" src="http://api.map.baidu.com/library/TextIconOverlay/1.2/src/TextIconOverlay_min.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/library/MarkerClusterer/1.2/src/MarkerClusterer_min.js"></script>
<style>
    img{
        max-width: none;
    }
</style>
</head>
	<body>

<!--Background Image-->
<img src="/static/images/bg.jpg" id="background"/>
<!--Background Image-->
<!--WRAPPTER START-->
<div class="wrapepr floral-bg">
	<!--header start-->
    <div class="header">
        <div class="clearfix"></div>
        <div class="container">
        <div class="couple-name">
            <div class="couple-name-holder">
                <div class="first-name resize">
                	<h1>刘文斌</h1>
                </div>
                <img src="/static/images/heart3.png" style="margin-left: 10px"/>
                <div class="last-name resize">
                    <h1>陈晓静</h1>
                </div>
            </div>
        </div>
        <div class="inner">
        <div class="getting-merried">
        	<p>爱的小窝</p>
        </div>
        </div>
      </div>
      </div>
      <div class="clearfix"></div>
    <!--header start-->
    <div class="content">
        <div class="inner">
            <!--navigation start-->
            <div class="navigation relative">
            	<span class="border1 resize">
                	<span class="border2"></span>
                </span>
                <ul id="nav">
                    <li><a href="/static/index.html">首页</a></li>
                    <li><a href="/static/travel.html">我们的旅程</a></li>
                    <li><a href="/static/memory.html">我们的回忆</a></li>
                    <li><a href="/static/gallery.html">我们的精彩</a></li>
                    <li><a href="/static/privity.html">我们的默契</a></li>
                    <li><a href="/static/location.html">我在这里</a></li>
                </ul>
            </div>
            <!--navigation end-->
            <div class="clearfix"></div>
            <!--content start-->
            <!--banners start-->
            	<div class="banner relative">
                	<img src="/static/images/banner-img.png" alt="">
                    <h2>我们的旅程</h2>
                	<div class="banner-pettern"></div>
                </div>
                <div class="clearfix"></div>
                <!--banners end-->
                <div class="top-borderline relative">
                	<div class="top-left-corner"><img src="/static/images/top-left-corner.png" alt=""></div>
                    <div class="top-right-corner"><img src="/static/images/top-right-corner.png" alt=""></div>
                </div>
            <div class="inner padding40px content-borders resize">
                <a href="/static/travel.html" class="btn btn-default" style="margin-right: 0px">返回</a>
                <div id="bigMap" style="width: 100%;height:600px"></div>
                <div class="register" style="padding:1px 0"></div>
                <div class="clearfix"></div>
            </div>
            <!--content end-->
        </div>
     <!--FOOTER START-->
    <div class="footer relative">
        <div class="footer-leftside"></div>
        <div class="followus resize">
            <p>相爱是一种很完美的感觉，与你相识相知相爱成就了这种完美，我深爱你和感谢你！愿与你携手一生，相恋相伴相守一辈子！</p>
            <div class="clearfix"></div>
        </div>
    <div class="footer-rightside"></div>
    </div>
    <!--FOOTER START-->
    </div>
    <div class="clearfix"></div>
</div>
<script>
    var icon = new BMap.Icon('/static/images/mapheart.png', new BMap.Size(20, 42), {
       anchor: new BMap.Size(12, 23)
    });
    var map = new BMap.Map("bigMap");    // 创建Map实例
	map.centerAndZoom(new BMap.Point(116.404, 39.915), 15);
	map.enableScrollWheelZoom(true);
	map.addControl(new BMap.NavigationControl());
	getPoints();
	var geoc = new BMap.Geocoder();
	function getPoints(){
	    $.ajax({
            url:"/getAllPoint",
            type:"POST",
            success:function(data){
                var lon = 0;
                var lat = 0;
                var markers = [];
                $.each(data,function(i,n){
                    lon = n.lon;
                    lat = n.lat;
                    var marker = new BMap.Marker(new BMap.Point(n.lon, n.lat),{icon:icon});
                    marker.setTitle(n.travelName);
                    //聚合使用
                    markers.push(marker);
                    map.addOverlay(marker);
                    marker.addEventListener("click",function(){
                        var p = marker.getPosition();
                        var location = "";
                        geoc.getLocation(p, function(rs){
                            var addComp = rs.addressComponents;
                            location = addComp.province + addComp.city + addComp.district + addComp.street + addComp.streetNumber;
                            $.ajax({
                                url:"/getByLonLat",
                                dataType: 'json',
                                data:"lon="+p.lng+"&lat="+p.lat,
                                type:"POST",
                                success:function(data){
                                    data = data[0];
                                    var html = "<h4 style='margin:0 0 5px 0;padding:0.2em 0'>["+data.type+"] "+data.travelName+"</h4>" +
                                    "<img style='float:right;margin:4px' id='imgDemo' src='"+data.indexImg+"' width='139' height='104' title='"+data.travelName+"'/>" +
                                    "<p style='margin:0;line-height:1.5;font-size:13px;text-indent:2em'><b>时间："+data.travelTime+"</b></p>" +
                                    "<p style='margin:0;line-height:1.5;font-size:13px;text-indent:2em'><b>地点："+location+"</b></p>" +
                                    "<p style='margin:0;line-height:1.5;font-size:13px;text-indent:2em'>"+data.content+"</p>" +
                                    "</div>";
                                    var infoWindow = new BMap.InfoWindow(html,{width:500,offset:new BMap.Size(0, -10)});
                                    marker.openInfoWindow(infoWindow);
                                   //图片加载完毕重绘infowindow
                                   document.getElementById('imgDemo').onload = function (){
                                       infoWindow.redraw();   //防止在网速较慢，图片未加载时，生成的信息框高度比图片的总高度小，导致图片部分被隐藏
                                   }
                                }
                            });
                        });
                    });
                });
                //聚合
                //new BMapLib.MarkerClusterer(map, {markers:markers});
                map.centerAndZoom(new BMap.Point(lon, lat), 15);
            }
        });
    }
</script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?18aa1da465cbe156fc3e7c413f9b2add";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>
</body>
</html>
