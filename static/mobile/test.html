<!DOCTYPE HTML>
<body>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>1</title>
<link rel="shortcut icon" href="/static/images/favicon.ico" type="image/x-icon" />
<link href="/static/css/style.css" rel="stylesheet" type="text/css">
<link href="/static/css/color.css" rel="stylesheet" type="text/css">
<link href="/static/css/bootstrap-responsive.css" rel="stylesheet" type="text/css">
<link href="/static/css/bootstrap.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="/static/js/jquery-1.8.3.js"></script>
<script type="text/javascript" src="/static/js/bootstrap.js"></script>
<script type="text/javascript" src="/static/js/jquery.cookie.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=0LSHte0xuZrXWUrnkEDIIMfwlOnYfiTA"></script>
<script type="text/javascript" src="http://api.map.baidu.com/library/TextIconOverlay/1.2/src/TextIconOverlay_min.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/library/MarkerClusterer/1.2/src/MarkerClusterer_min.js"></script>
</head>
<body>
<div id="locationMap" style="width: 100%;height:440px"></div>
<script>

    $("body").removeClass("background-image");

    var colors = {"0": "#292929", "1": "#292a2e", "2": "#2a2c34", "3": "#36373c", "4": "#736d4c", "5": "#e9cf65", "6": "#ffdf8f", "7": "#ffb2b0", "8": "#ef949c", "9": "#d66d74", "10": "#bd484a", "11": "#af3130", "12": "#b62e32", "13": "#cb3a45", "14": "#e65061", "15": "#fb677a", "16": "#ff9090", "17": "#ffc59f", "18": "#eecc9a", "19": "#9d9179", "20": "#555555", "21": "#3c3e42", "22": "#303133", "23": "#282828"};
    var pointMap = new Map();
    for(var i = 0;i < 24;i ++){
        var point = new BMap.Icon('/static/images/points/point'+i+'.png', new BMap.Size(26, 36), {
           anchor: new BMap.Size(21, 30)
        });
        pointMap.set(i,point);
    }
    var map = new BMap.Map("locationMap");    // 创建Map实例
	map.centerAndZoom(new BMap.Point(116.404, 39.915), 16);
	map.enableScrollWheelZoom(true);
	map.addControl(new BMap.NavigationControl());
    getTrackByHour(12);

	function getTrackByHour(hour){
        $.ajax({
            url:"/getTrackByHour",
            data:"hour="+hour,
            type:"POST",
            success:function(data){
                map.clearOverlays();
                var points = [];
                var lh = -1;
                var allPoints = []
                $.each(data.data,function(i,n){
                    if(n.h != undefined){
                        if(points.length != 0){
                            points.push(new BMap.Point(n.l, n.b));
                            var polyline = new BMap.Polyline(points, {strokeColor:colors[lh], strokeWeight:4, strokeOpacity:0.7});
                            map.addOverlay(polyline);
                            map.addOverlay(new BMap.Marker(new BMap.Point(n.l, n.b),{icon:pointMap.get(n.h)}));
                            points = []
                        }
                        lh = n.h;
                    }
                    points.push(new BMap.Point(n.l, n.b));
                    allPoints.push(new BMap.Point(n.l, n.b));
                });
                if(points.length != 0){
                    var polyline = new BMap.Polyline(points, {strokeColor:colors[lh], strokeWeight:4, strokeOpacity:0.7});
                    map.addOverlay(polyline);
                }
                var view = map.getViewport(eval(allPoints));
                var mapZoom = view.zoom;
                var centerPoint = view.center;
                map.centerAndZoom(centerPoint,mapZoom);
            }
        });
    }
</script>
</body>
</html>
