<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>【文斌 & 静静】爱的小窝-我们的旅程</title>
<link rel="shortcut icon" href="/static/images/favicon.ico" type="image/x-icon" />
<link href="/static/css/style.css" rel="stylesheet" type="text/css">
<link href="/static/css/color.css" rel="stylesheet" type="text/css">
<link href="/static/css/bootstrap-responsive.css" rel="stylesheet" type="text/css">
<link href="/static/css/bootstrap.css" rel="stylesheet" type="text/css">
<link href="/static/css/countdown.css" rel="stylesheet" type="text/css">
<link href="/static/css/prettyPhoto.css" rel="stylesheet">
<script type="text/javascript" src="/static/js/jquery-1.8.3.js"></script>
<script type="text/javascript" src="/static/js/mobile.js"></script>
<script type="text/javascript" src="/static/js/bootstrap.js"></script>
<script type="text/javascript" src="/static/js/jquery.countdown.js"></script>
<script type="text/javascript" src="/static/js/jquery.prettyPhoto.js"></script>
<script type="text/javascript" src="/static/js/lightbox.js"></script>
<script type="text/javascript" src="/static/js/custom.js"></script>
<script type="text/javascript" src="/static/js/jquery.cookie.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=0LSHte0xuZrXWUrnkEDIIMfwlOnYfiTA"></script>
<script type="text/javascript" src="/static/js/scrolltopcontrol.js"></script>
<style>
    .inner, .container{
        width: 100% !important;
    }
    body {
        padding-right:0px;
        padding-left:0px
    }
    .event-text ul li{
        padding: 0px;
        font-size: 16px;
    }
    .fenlei p{
        margin: 0px;
    }
</style>
</head>
	<body>

<!--Background Image-->
<img src="/static/images/bg.jpg" id="background"/>
<!--Background Image-->
<!--WRAPPTER START-->
<div class="wrapepr floral-bg">
	<!--header start-->
    <div class="header">
        <div class="clearfix"></div>
        <div class="container">
        <div class="couple-name">
            <div class="couple-name-holder">
                <div class="first-name resize">
                	<h1>刘文斌</h1>
                </div>
                <img src="/static/images/heart3.png" style="margin-left: 10px;width:21%"/>
                <div class="last-name resize">
                    <h1>陈晓静</h1>
                </div>
            </div>
        </div>
        <div class="inner">
        <div class="getting-merried">
        	<p>爱的小窝</p>
        </div>
        </div>
      </div>
      </div>
      <div class="clearfix"></div>
    <!--header start-->
    <div class="content">
        <div class="inner">
            <!--navigation start-->
            <div class="navigation relative">
            	<span class="border1 resize">
                	<span class="border2"></span>
                </span>
                <ul id="nav">
                    <li><a href="/static/index.html">首页</a></li>
                    <li><a href="/static/travel.html">我们的旅程</a></li>
                    <li><a href="/static/memory.html">我们的回忆</a></li>
                    <li><a href="/static/gallery.html">我们的精彩</a></li>
                    <li><a href="/static/privity.html">我们的默契</a></li>
                    <li><a href="/static/location.html">我在这里</a></li>
                </ul>
            </div>
            <!--navigation end-->
            <div class="clearfix"></div>
            <!--content start-->
            <!--banners start-->
            	<div class="banner relative">
                	<img src="/static/images/banner-img.png" alt="">
                    <h2>我们的旅程</h2>
                	<div class="banner-pettern"></div>
                </div>
                <div class="clearfix"></div>
                <!--banners end-->
            <div class="inner padding40px resize">
                <div class="events pretty-photos">
                	<div class="rightbar" style="margin-bottom: 20px">
                    	<!--location map widget start-->
                    	<div class="widget map">
                        	<!--heading start-->
                        	<div class="heading">
                                <h2><a href="/static/map.html">地点</a></h2>
                                <span class="dot-left"></span>
                                <span class="dot-right"></span>
                            </div>
                            <!--heading start-->
                            <div id="travelmap" style="border: 1px solid #000;width: 100%;height :300px"></div>
                        </div>
                        <div>内容搜索：
                            <select id="searchSelect" class="form-control">
                            </select>
                            <input class="form-control" id="searchBtn">
                            <button>搜索</button>
                        </div>
                    </div>
                    <div class="leftbar" >
                        <div id="travelTongji" class="alert alert-info" role="alert"></div>
                        <div id="contentDiv"></div>
                    </div>
                    <div class="rightbar">
                        <div class="widget message-board">
                        <!--heading start-->
                        	<div class="heading">
                            	<h2>时间</h2>
                                <span class="dot-left"></span>
                                <span class="dot-right"></span>
                            </div>
                            <!--heading start-->
                        	<ul id="dateul"></ul>
                        </div>
                    </div>
                </div>
                <div class="register" style="padding:1px 0"></div>
                <div class="clearfix"></div>
            </div>
            <!--content end-->
        </div>
    </div>
    <div class="clearfix"></div>
</div>
<script>
    var id = "";
    var isShowLastPointInMap = true;
    if(location.href.indexOf("id=") != -1) {
        id = location.href.split("=")[1]
        if(id.indexOf("#") != -1){
            id = id.split("#")[0];
        }
    }
    var map = new BMap.Map("travelmap");    // 创建Map实例
	map.centerAndZoom(new BMap.Point(116.404, 39.915), 15);
	map.enableScrollWheelZoom(true);
	function getPoints(){
	    $.ajax({
            url:"/getAllPoint",
            type:"POST",
            success:function(data){
                var lon = 0;
                var lat = 0;
                $.each(data,function(i,n){
                    lon = n.lon;
                    lat = n.lat;
                    var marker = new BMap.Marker(new BMap.Point(n.lon, n.lat));
                    var label = new BMap.Label(n.travelName,{offset:new BMap.Size(20,-10)});
                    map.addOverlay(marker);
                    marker.setLabel(label);
                    marker.addEventListener("click",getAttr);
                    function getAttr(){
                        var p = marker.getPosition();
                        getContentByLonLat(p.lng,p.lat);
                    }
                });
                if(isShowLastPointInMap){
                    map.centerAndZoom(new BMap.Point(lon, lat), 15);
                }
            }
        });
    }
	function getDates(){
	    $.ajax({
            url:"/getTravelTimeGroup",
            type:"POST",
            success:function(data){
                var html = "";
                var searchSelectOption = "";
                $.each(data,function(i,n){
                    html += "<li><a href=\"javascript:;\" onclick='getByDate(\""+n.ym+"\")'><h5>"+n.ym+"</h5></a></li>";
                    searchSelectOption += "<option value='"+n.ym.replace("年","").replace("月","")+"'>"+n.ym+"</option>";
                });
                $("#dateul").html(html);
                $("#searchSelect").html(searchSelectOption);
            }
        });
    }

    function getNew5(){
	    $.ajax({
            url:"/getNew5",
            type:"POST",
            success:function(data){
                var html = "";
                $.each(data,function(i,n){
                    html += getTravelContent(n);
                });
                $("#contentDiv").html(html);
                isShowLastPointInMap = true;
            }
        });
    }

    function getById(){
	    $.ajax({
            url:"/getTravelInfoById",
            data:"id=" + id,
            type:"POST",
            success:function(data){
                var html = "";
                $.each(data,function(i,n){
                    html += getTravelContent(n);
                    map.centerAndZoom(new BMap.Point(n.lon, n.lat), 15);
                });
                $("#contentDiv").html(html);
                isShowLastPointInMap = false;
            }
        });
    }

    function getContentByLonLat(lon, lat){
        $.ajax({
            url:"/getByLonLat",
            dataType: 'json',
            data:"lon="+lon+"&lat="+lat,
            type:"POST",
            success:function(data){
                var html = ""
                $.each(data,function(i,n){
                    html += getTravelContent(n);
                });
                $("#contentDiv").html(html);
            }
        });
    }
    getDates();
    if(id != ""){
        getById();
    }else{
        getNew5();
    }
    getPoints();
    function locate(lon,lat){
        map.panTo(new BMap.Point(lon, lat), 15);
    }
    function getByDate(date){
        $.ajax({
            url:"/getByDate",
            dataType: 'json',
            data:"date="+date,
            type:"POST",
            success:function(data){
                var html = "";
                var lon = 0;
                var lat = 0;
                $.each(data,function(i,n){
                    if(lon == 0){
                        lon = n.lon;
                    }
                    if(lat == 0){
                        lat = n.lat;
                    }
                    html += getTravelContent(n);
                });
                $("#contentDiv").html(html);
                map.panTo(new BMap.Point(lon, lat));
            }
        });
    }
    function getTongji(){
        $.ajax({
            url:"/getTravelTongji",
            dataType: 'json',
            type:"POST",
            success:function(data){
                var html = "亲爱哒，在我们相遇的这段日子里<br/>";
                html += "一共去了<b>"+data.travelTotalCount+"</b>个地方<br/>";
                html += "在<b>"+data.travelHasPicCount+"</b>个地方留下照片，一共有<b>"+data.totalPicCount+"</b>张<br/>"
                html += "其中在<b><a href='/static/travel.html?id="+data.maxPicTravelId+"'>"+data.maxPicTravelName+"</a></b>留下了<b>"+data.maxPicTravelCount+"</b>张照片<br/>"
                html += "一共看了<b>"+data.movieCount+"</b>场电影和演出<br/>";
                html += "我们看的最多的是<b>"+data.maxMovieType+"片</b>，看了<b>"+data.maxMovieTypeCount+"</b>场<br/>";
                html += "我们一起吃了<b>"+data.foodCount+"</b>顿饭，有<b>"+data.maxFoodTypeCount+"</b>顿吃的<b>"+data.maxFoodType+"</b>";
                $("#travelTongji").html(html);
            }
        });
    }
    getTongji();
    function getTravelContent(n){
        var tag = "<p>标签：";
        var keyword = n.keyword;
        var hasTag = false;
        if(keyword != ""){
            hasTag = true;
            if(keyword.indexOf(",") != -1){
                var ks = keyword.split(",");
                for(var i = 0;i < ks.length;i++){
                    tag += "<code>"+ks[i]+"</code>";
                }
            }else{
                tag += "<code>"+keyword+"</code>";
            }
        }
        var direction = n.direction;
        if(direction != ""){
            hasTag = true;
            tag += "<code>"+direction+"</code>";
        }
        tag += "</p>";
        if(!hasTag){
            tag = ""
        }

        var address = "";
        if(n.country != "中国"){
            address += n.country;
        }
        address += n.province;
        if(n.province != n.city){
            address += n.city;
        }
        address += n.district;
        var weather = "";
        if(n.dayWeather != "None" && n.dayWeather != "" && n.nightWeather != "None" && n.nightWeather != ""){
            weather = "\t    \t<p>天气：";
            weather += "<img data-toggle=\"tooltip\" data-placement=\"left\" title=\""+n.dayWeather+"\" alt='"+n.dayWeather+"' width='24' height='24' src='/static/images/weather/"+n.dayIcon+".gif'/>";
            weather += "<img data-toggle=\"tooltip\" data-placement=\"left\" title=\""+n.nightWeather+"\" alt='"+n.nightWeather+"' width='24' height='24' src='/static/images/weather/"+n.nightIcon+".gif'/>";
            weather += "&nbsp;&nbsp;&nbsp;&nbsp;"+n.minTemp+"℃到"+n.maxTemp+"℃";
            weather += "</p>\n";
        }
        var movie = "";
        if(n.movieName != "None" && n.movieName != ""){
            movie += "<p>剧目：《"+n.movieName+"》";
            if(n.movieType != "None" && n.movieType != "" && n.movieType != "暂无类型"){
                movie += "("+n.movieType+")";
            }
            movie += "</p>";
        }
        var food = "";
        if(n.foodType != "None" && n.foodType != ""){
            food += "<p>类型："+n.foodType +　"</p>";
        }
        var holiday = "";
        if(n.holiday != ""){
            holiday += "<p>节日："+n.holiday +　"</p>";
        }
        var re = new RegExp("\\|","g")
        var space4 = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
        var content = space4 + n.content;
        if(content.indexOf("|") != -1){
            content = content.replace(re,"<br>"+space4);
        }
        content = addEmoji(content);
        var delay = "";
        if(n.delay >= 1){
            delay = n.delay+"天前"
        }
        return "<div class=\"event-box relative\">\n" +
            "\t<div class=\"story-avatar relative\">\n" +
            "\t<img onclick='locate("+n.lon+","+n.lat+")' style='width:100%;' alt=\"\" src=\""+n.indexImg+"\">\n" +
            "\t<div class=\"image-tip\">\n" +
            "\t\t<a href=\"javascript:;\">"+n.travelName+"</a>\n" +
            "\t</div>\n" +
            "\t</div>\n" +
            "\t<div class=\"event-text\">\n" +
            "\t\t<h2>["+n.type+"] "+n.travelName+"</h2>\n" +
            "\t\t<div class='fenlei alert alert-info' style='margin-top:10px;margin-bottom:10px;background-color:#f2f6f7;border-color:#fff'>\n" +
            "\t    \t<p>时间："+n.travelTime+"&nbsp;&nbsp;"+n.weekDay+"&nbsp;&nbsp;"+delay+"</p>\n" +
            "\t    \t<p>地点："+address+"</p>\n" +
            weather+
            holiday+
            movie+
            food+
            tag +
            "\t    </div>\n"+
            "\t    <p style='font-size:17px'>"+content+"</p>\n" +
            (n.hasImg == "1"?"\t    \t<ul><li><a target='_blank' href='/static/traimg.html?i="+n.id+"'>&gt;&gt;查看照片</a></li></ul>\n":"") +
            "\t</div>               \t\n" +
            "\t<span class=\"dot-left\"></span>\n" +
            "\t<span class=\"flower\"><img alt=\"\" src=\"/static/images/flower2.png\"></span>\n" +
            "\t<span class=\"dot-right\"></span>\n" +
            "</div>";
    }
    function addEmoji(content){
        var emojis = ["daxiao","haixiu","huaixiao","ku","qinqin","se","tiaopi","weixiao"];
        for(var i = 0;i < emojis.length;i ++){
            var emoji = emojis[i];
            if(content.indexOf("["+emoji+"]") != -1){
                var re = new RegExp("\\["+emoji+"\\]","g")
                content = content.replace(re,"<img src='/static/images/emoji/"+emoji+".gif' width='27px' height='27px'/>")
            }
        }
        return content;
    }
</script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?18aa1da465cbe156fc3e7c413f9b2add";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>
</body>
</html>
